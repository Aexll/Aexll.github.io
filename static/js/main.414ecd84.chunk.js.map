{"version":3,"sources":["App.js","index.js"],"names":["client","Binance","play","App","useState","pairName","nb_click","advanceClick","chart","useRef","chartContainerRef","candleSeries","useEffect","current","createChart","width","clientWidth","height","clientHeight","layout","backgroundColor","textColor","grid","vertLines","color","horzLines","crosshair","mode","CrosshairMode","Normal","priceScale","borderColor","timeScale","console","log","addCandlestickSeries","upColor","downColor","borderDownColor","borderUpColor","wickDownColor","wickUpColor","cleaner","thedata","setData","fetchPrevAndSubscribe","now","Date","getTime","candles","symbol","interval","limit","endTime","prevData","datas","Array","isArray","map","data","time","openTime","startTime","open","high","low","close","slice","setInterval","className","class","onClick","viewBox","d","ref","rootElement","document","getElementById","createRoot","render"],"mappings":"sgBAKMA,EAASC,MACXC,GAAO,EAcI,SAASC,IACtB,MAAgCC,mBAAS,WAAzC,mBAAOC,EAAP,KACA,GADA,KACiCD,mBAAS,IAA1C,mBAAOE,EAAP,KAAiBC,EAAjB,KAIMC,EAAQC,mBACRC,EAAoBD,mBACpBE,EAAeF,mBACrBG,qBAAU,WACJJ,EAAMK,UAGVL,EAAMK,QAAUC,YAAYJ,EAAkBG,QAAS,CACrDE,MAAOL,EAAkBG,QAAQG,YACjCC,OAAQP,EAAkBG,QAAQK,aAClCC,OAAQ,CACNC,gBAAiB,UACjBC,UAAW,4BAEbC,KAAM,CACJC,UAAW,CACTC,MAAO,WAETC,UAAW,CACTD,MAAO,YAGXE,UAAW,CACTC,KAAMC,IAAcC,QAEtBC,WAAY,CACVC,YAAa,WAEfC,UAAW,CACTD,YAAa,aAIjBE,QAAQC,IAAI1B,EAAMK,SAElBF,EAAaE,QAAUL,EAAMK,QAAQsB,qBAAqB,CACxDC,QAAS,UACTC,UAAW,UACXC,gBAAiB,UACjBC,cAAe,UACfC,cAAe,UACfC,YAAa,YAGhB,GAAE,IAEH,IAiBMC,EAAUjC,mBACZkC,EAAUlC,mBAgGd,OA/FAG,qBAAU,WACJ8B,EAAQ7B,UAEVoB,QAAQC,IAAI,gCAAiCQ,EAAQ7B,SACrD6B,EAAQ7B,UAERF,EAAaE,QAAQ+B,QAAQ,KAoB/B,IAAMC,EAAqB,iDAAG,uGAKtBC,EAAM,IAAIC,KAAK,uBAAuBC,UALhB,SAQPhD,EAAOiD,QAAQ,CAClCC,OAAQ7C,EACR8C,SAAU,KACVC,MAAO,IACPC,QAASP,IAZiB,OAQxBQ,EARwB,OA7CbC,EA2DOD,EA1DxBrB,QAAQC,IAAI,cAAeqB,GACtBC,MAAMC,QAAQF,KACjBA,EAAQ,CAACA,IAwDTD,EAvDKC,EAAMG,KAAI,SAAAC,GAAI,MAAK,CACxBC,KAAMD,EAAKE,UAAYF,EAAKG,UAC5BC,KAAMJ,EAAKI,KACXC,KAAML,EAAKK,KACXC,IAAKN,EAAKM,IACVC,MAAOP,EAAKO,MALO,IAwDnBjC,QAAQC,IAAI,cAAeoB,GAE3BX,EAAQ9B,QAAUyC,EAClB3C,EAAaE,QAAQ+B,QAAQD,EAAQ9B,QAAQsD,MAAM,EAAE,IAAI7D,IAlB7B,iCA7Cb,IAAAiD,CA6Ca,UAAH,qDAsB3BV,GACD,GAAE,CAACxC,IAEJO,qBAAU,WACHD,EAAaE,SAEb8B,EAAQ9B,UAEbF,EAAaE,QAAQ+B,QAAQD,EAAQ9B,QAAQsD,MAAM,EAAE,IAAI7D,IACzD2B,QAAQC,IAAI,WAAWS,EAAQ9B,SAChC,GAAC,CAACP,IA8BH8D,aAAY,WACPlE,GACDK,EAAaD,EAAS,EACzB,GAAE,IAKD,sBAAK+D,UAAU,MAAf,UAEE,sBAAKC,MAAM,OAAX,UACE,oBAAIA,MAAM,QAAV,gCACA,wBAAQA,MAAM,WAAWC,QAAS,WArLtCrE,GADCA,CAsLqC,EAAlC,SACE,qBAAKoE,MAAM,WAAWE,QAAQ,YAA9B,SACH,sBAAMC,EAAE,wgBAIT,qBAAKH,MAAM,QAAQI,IAAKhE,MAG7B,CCnMD,IAAMiE,EAAcC,SAASC,eAAe,QAC/BC,qBAAWH,GAEnBI,OACH,cAAC,aAAD,UACE,cAAC5E,EAAD,M","file":"static/js/main.414ecd84.chunk.js","sourcesContent":["import \"./styles.css\";\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport Binance from \"binance-api-node\";\r\nimport { createChart, CrosshairMode } from 'lightweight-charts';\r\n\r\nconst client = Binance();\r\nvar play = false;                  //  set your counter to 1\r\nvar speed = 100;\r\nfunction switchplay() {\r\n  if(play)\r\n    play=false\r\n  else\r\n    play=true\r\n}\r\nfunction setSpeed(event) {\r\n  speed=event.target.value\r\n  console.log(\"speed\",speed)\r\n}\r\n\r\n\r\nexport default function App() {\r\n  const [pairName, setPairName] = useState(\"BTCUSDT\");\r\n  const [nb_click, advanceClick] = useState(0);\r\n\r\n  // chart creation\r\n  // full example (without realtime data): https://codesandbox.io/s/9inkb?file=/src/index.js\r\n  const chart = useRef();\r\n  const chartContainerRef = useRef();\r\n  const candleSeries = useRef();\r\n  useEffect(() => {\r\n    if (chart.current)\r\n      return\r\n\r\n    chart.current = createChart(chartContainerRef.current, {\r\n      width: chartContainerRef.current.clientWidth,\r\n      height: chartContainerRef.current.clientHeight,\r\n      layout: {\r\n        backgroundColor: '#253248',\r\n        textColor: 'rgba(255, 255, 255, 0.9)',\r\n      },\r\n      grid: {\r\n        vertLines: {\r\n          color: '#334158',\r\n        },\r\n        horzLines: {\r\n          color: '#334158',\r\n        },\r\n      },\r\n      crosshair: {\r\n        mode: CrosshairMode.Normal,\r\n      },\r\n      priceScale: {\r\n        borderColor: '#485c7b',\r\n      },\r\n      timeScale: {\r\n        borderColor: '#485c7b',\r\n      },\r\n    });\r\n\r\n    console.log(chart.current);\r\n\r\n    candleSeries.current = chart.current.addCandlestickSeries({\r\n      upColor: '#4bffb5',\r\n      downColor: '#ff4976',\r\n      borderDownColor: '#ff4976',\r\n      borderUpColor: '#4bffb5',\r\n      wickDownColor: '#838ca1',\r\n      wickUpColor: '#838ca1',\r\n    });\r\n\r\n  }, [])\r\n\r\n  const formatOHLC = datas => {\r\n    console.log(\"formatohlc \", datas)\r\n    if (!Array.isArray(datas))\r\n      datas = [datas]\r\n    return datas.map(data => ({\r\n      time: data.openTime || data.startTime,\r\n      open: data.open,\r\n      high: data.high,\r\n      low: data.low,\r\n      close: data.close\r\n    }))\r\n  }\r\n\r\n  // binance data subscription\r\n  // cleaner is a function to unsubscribe a previous subscription\r\n\r\n  \r\n  const cleaner = useRef();\r\n  var thedata = useRef();\r\n  useEffect(() => {\r\n    if (cleaner.current) {\r\n      // unsubscribe from previous subscription\r\n      console.log(\"cleaned previous subscriber: \", cleaner.current)\r\n      cleaner.current()\r\n      // clear chart candles\r\n      candleSeries.current.setData([]);\r\n    }\r\n\r\n    // // subscribe to websocket for the future price update\r\n    // const clean = client.ws.candles(pairName, \"1h\", (res) => {\r\n    //   console.log(\"res: \", res)\r\n    //   const candleData = {\r\n    //     time: res.startTime,\r\n    //     open: res.open,\r\n    //     high: res.high,\r\n    //     low: res.low,\r\n    //     close: res.close\r\n    //   }\r\n    //   console.log(candleData.time, candleData.close)\r\n    //   candleSeries.current.update(candleData)\r\n    // });\r\n    // cleaner.current = clean;\r\n    // console.log(\"added new candles subscription for \", pairName)\r\n\r\n\r\n    const fetchPrevAndSubscribe = async () => {\r\n      // before subscribe to websocket, should prefill the chart with existing history, this can be fetched with normal REST request\r\n      // SHOULD DO THIS BEFORE SUBSCRIBE, HOWEVER MOVING SUBSCRIBE TO AFTER THIS BLOCK OF CODE WILL CAUSE THE SUBSCRIPTION GOES ON FOREVER\r\n      // REACT BUG?\r\n      // const now = Date.now()\r\n      const now = new Date('2022-09-12T15:30:00').getTime()// + nb_click*60000\r\n      // const now = new Date('September 10, 2022 23:15:30')\r\n\r\n      let prevData = await client.candles({\r\n        symbol: pairName,\r\n        interval: \"1m\",\r\n        limit: 10000,\r\n        endTime: now\r\n      })\r\n      prevData = formatOHLC(prevData)\r\n      console.log(\"prev data: \", prevData)\r\n      // candleSeries.current.setData(prevData);\r\n      thedata.current = prevData\r\n      candleSeries.current.setData(thedata.current.slice(0,500+nb_click))\r\n      \r\n    }\r\n\r\n    fetchPrevAndSubscribe()\r\n  }, [pairName])\r\n\r\n  useEffect(() => {\r\n    if(! candleSeries.current)\r\n      return\r\n    if(! thedata.current)\r\n      return\r\n    candleSeries.current.setData(thedata.current.slice(0,500+nb_click))\r\n    console.log(\"datatest\",thedata.current)\r\n  },[nb_click])\r\n  \r\n  /////////\r\n  \r\n  // const fetchPrevAndSubscribe = async () => {\r\n  //   // before subscribe to websocket, should prefill the chart with existing history, this can be fetched with normal REST request\r\n  //   // SHOULD DO THIS BEFORE SUBSCRIBE, HOWEVER MOVING SUBSCRIBE TO AFTER THIS BLOCK OF CODE WILL CAUSE THE SUBSCRIPTION GOES ON FOREVER\r\n  //   // REACT BUG?\r\n  //   // const now = Date.now()\r\n    // const now = new Date('2022-09-12T15:30:00').getTime()\r\n\r\n\r\n  //   let prevData = await client.candles({\r\n  //     symbol: pairName,\r\n  //     interval: \"1m\",\r\n  //     limit: 1000,\r\n  //     endTime: now\r\n  //   })\r\n  //   prevData = formatOHLC(prevData)\r\n  //   console.log(\"prev data: \", prevData)\r\n  //   candleSeries.current.setData(prevData);\r\n    \r\n\r\n  // }\r\n\r\n  // fetchPrevAndSubscribe();\r\n\r\n\r\n\r\n\r\n  setInterval(() => {\r\n    if(play)\r\n      advanceClick(nb_click+1)\r\n  }, 50);\r\n\r\n\r\n\r\n  return (\r\n    <div className=\"App\">\r\n\r\n      <div class=\"core\">\r\n        <h1 class=\"title\">Backtest for chads</h1>\r\n        <button class=\"button-9\" onClick={() => switchplay()}>\r\n          <svg class=\"svg-icon\" viewBox=\"0 0 20 20\">\r\n\t\t\t\t\t\t\t<path d=\"M12.522,10.4l-3.559,3.562c-0.172,0.173-0.451,0.176-0.625,0c-0.173-0.173-0.173-0.451,0-0.624l3.248-3.25L8.161,6.662c-0.173-0.173-0.173-0.452,0-0.624c0.172-0.175,0.451-0.175,0.624,0l3.738,3.736C12.695,9.947,12.695,10.228,12.522,10.4 M18.406,10c0,4.644-3.764,8.406-8.406,8.406c-4.644,0-8.406-3.763-8.406-8.406S5.356,1.594,10,1.594C14.643,1.594,18.406,5.356,18.406,10M17.521,10c0-4.148-3.374-7.521-7.521-7.521c-4.148,0-7.521,3.374-7.521,7.521c0,4.147,3.374,7.521,7.521,7.521C14.147,17.521,17.521,14.147,17.521,10\"></path>\r\n\t\t\t\t\t</svg>\r\n        </button>\r\n      </div>\r\n      <div class=\"graph\" ref={chartContainerRef} />\r\n    </div>\r\n  );\r\n}\r\n      // {pairName} \r\n      // <div ref={chartContainerRef} style={{ width: \"100%\", height: \"500px\"}} />\r\n      // <span>{speed}</span>\r\n      // <input type=\"range\" onInput={setSpeed}></input>\r\n      // <button onClick={() => advanceClick(nb_click+0)}>+1</button>\r\n      // <div>Current selection: {pairName}</div>\r\n      // <span onClick={() => setPairName(\"BTCUSDT\")}>BTCUSDT, </span>\r\n      // <span onClick={() => setPairName(\"ETHUSDT\")}>ETHUSDT, </span>\r\n","import { StrictMode } from \"react\";\r\nimport { createRoot } from \"react-dom/client\";\r\n\r\nimport App from \"./App\";\r\n\r\nconst rootElement = document.getElementById(\"root\");\r\nconst root = createRoot(rootElement);\r\n\r\nroot.render(\r\n  <StrictMode>\r\n    <App />\r\n  </StrictMode>\r\n);\r\n"],"sourceRoot":""}